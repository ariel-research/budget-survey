{% extends "base.html" %}

{% block additional_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard_style.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <div class="dashboard-container">
        <!-- Header Section -->
        <header class="dashboard-header">
            <div class="header-content">
                <h1>{{ translations.title }}</h1>
                <p class="header-description">{{ translations.subtitle }}</p>
            </div>
        </header>

        <!-- Health Strip -->
        <div class="health-strip" role="region" aria-label="Dashboard health metrics">
            <div class="stat-card">
                <div class="stat-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                </div>
                <div class="stat-content">
                    <div class="stat-label">{{ translations.total_surveys }}</div>
                    <div class="stat-value">{{ total_surveys }}</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </div>
                <div class="stat-content">
                    <div class="stat-label">{{ translations.total_participants }}</div>
                    <div class="stat-value">{{ total_participants }}</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
                    </svg>
                </div>
                <div class="stat-content">
                    <div class="stat-label">{{ translations.blocked_users }}</div>
                    <div class="stat-value">{{ unaware_users_count }}</div>
                </div>
            </div>
        </div>

        <!-- Command Bar -->
        <div class="command-bar">
            <div class="search-wrapper">
                <div class="search-icon" aria-hidden="true">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </div>
                <input type="text" 
                       class="search-input" 
                       placeholder="{{ translations.search_placeholder }}"
                       data-search-term>
            </div>

            <div class="filter-group">
                <div class="toggle-group">
                    <button class="btn-toggle active" data-filter="active">
                        {{ translations.active_data_toggle }}
                    </button>
                    <button class="btn-toggle" data-filter="all">
                        {{ translations.all_surveys_toggle }}
                    </button>
                </div>

                <select id="filterStrategy" class="filter-select" data-all-label="{{ translations.filter_all_strategies }}">
                    <option value="all">{{ translations.filter_all_strategies }}</option>
                </select>

                <select id="filterStory" class="filter-select" data-all-label="{{ translations.filter_all_stories }}">
                    <option value="all">{{ translations.filter_all_stories }}</option>
                </select>

                <select id="filterDim" class="filter-select" data-all-label="{{ translations.filter_all_dims }}">
                    <option value="all">{{ translations.filter_all_dims }}</option>
                </select>

                <button id="resetFilters" class="btn-reset" title="Reset Filters">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Master Table -->
        <div class="table-responsive">
            <table class="master-table">
                <thead>
                    <tr>
                        <th class="sortable center-align" data-sort-key="id" data-sort-state="none" aria-sort="none">
                            <span class="th-content">
                                <span>{{ translations.col_id }}</span>
                                <span class="sort-icon" aria-hidden="true">
                                    <svg viewBox="0 0 16 16" width="14" height="14">
                                        <path class="icon-up" d="M8 3 L11 6 H5 Z" fill="currentColor"></path>
                                        <path class="icon-down" d="M8 13 L5 10 H11 Z" fill="currentColor"></path>
                                    </svg>
                                </span>
                            </span>
                        </th>
                        <th class="sortable" data-sort-key="date" data-sort-state="none" aria-sort="none">
                            <span class="th-content">
                                <span>{{ translations.col_date }}</span>
                                <span class="sort-icon" aria-hidden="true">
                                    <svg viewBox="0 0 16 16" width="14" height="14">
                                        <path class="icon-up" d="M8 3 L11 6 H5 Z" fill="currentColor"></path>
                                        <path class="icon-down" d="M8 13 L5 10 H11 Z" fill="currentColor"></path>
                                    </svg>
                                </span>
                            </span>
                        </th>
                        <th class="sortable center-align" data-sort-key="status" data-sort-state="none" aria-sort="none">
                            <span class="th-content">
                                <span>{{ translations.col_status }}</span>
                                <span class="sort-icon" aria-hidden="true">
                                    <svg viewBox="0 0 16 16" width="14" height="14">
                                        <path class="icon-up" d="M8 3 L11 6 H5 Z" fill="currentColor"></path>
                                        <path class="icon-down" d="M8 13 L5 10 H11 Z" fill="currentColor"></path>
                                    </svg>
                                </span>
                            </span>
                        </th>
                        <th class="sortable" data-sort-key="strategy" data-sort-state="none" aria-sort="none">
                            <span class="th-content">
                                <span>{{ translations.col_identity }}</span>
                                <span class="sort-icon" aria-hidden="true">
                                    <svg viewBox="0 0 16 16" width="14" height="14">
                                        <path class="icon-up" d="M8 3 L11 6 H5 Z" fill="currentColor"></path>
                                        <path class="icon-down" d="M8 13 L5 10 H11 Z" fill="currentColor"></path>
                                    </svg>
                                </span>
                            </span>
                        </th>
                        <th class="sortable" data-sort-key="story" data-sort-state="none" aria-sort="none">
                            <span class="th-content">
                                <span>{{ translations.col_story }}</span>
                                <span class="sort-icon" aria-hidden="true">
                                    <svg viewBox="0 0 16 16" width="14" height="14">
                                        <path class="icon-up" d="M8 3 L11 6 H5 Z" fill="currentColor"></path>
                                        <path class="icon-down" d="M8 13 L5 10 H11 Z" fill="currentColor"></path>
                                    </svg>
                                </span>
                            </span>
                        </th>
                        <th class="sortable center-align" data-sort-key="dim" data-sort-state="none" aria-sort="none">
                            <span class="th-content">
                                <span>{{ translations.col_dim }}</span>
                                <span class="sort-icon" aria-hidden="true">
                                    <svg viewBox="0 0 16 16" width="14" height="14">
                                        <path class="icon-up" d="M8 3 L11 6 H5 Z" fill="currentColor"></path>
                                        <path class="icon-down" d="M8 13 L5 10 H11 Z" fill="currentColor"></path>
                                    </svg>
                                </span>
                            </span>
                        </th>
                        <th class="sortable center-align" data-sort-key="vol" data-sort-state="none" aria-sort="none">
                            <span class="th-content">
                                <span>{{ translations.col_volume }}</span>
                                <span class="sort-icon" aria-hidden="true">
                                    <svg viewBox="0 0 16 16" width="14" height="14">
                                        <path class="icon-up" d="M8 3 L11 6 H5 Z" fill="currentColor"></path>
                                        <path class="icon-down" d="M8 13 L5 10 H11 Z" fill="currentColor"></path>
                                    </svg>
                                </span>
                            </span>
                        </th>
                        <th>{{ translations.col_actions }}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="noResultsRow" hidden>
                        <td colspan="8" class="no-results">
                            <div class="no-results-content">
                                <p>{{ translations.no_results_found }}</p>
                                <button id="clearFiltersBtn" class="btn-clear-filters">{{ translations.clear_all_filters }}</button>
                            </div>
                        </td>
                    </tr>
                    {% for survey in surveys_console %}
                    <tr class="survey-row" 
                        data-survey-id="{{ survey.id }}"
                        data-is-active="{{ 'true' if survey.is_active_data else 'false' }}"
                        data-val-id="{{ survey.id }}"
                        data-val-date="{{ survey.sort_date }}"
                        data-val-status="{{ 1 if survey.is_active_data else 0 }}"
                        data-val-strategy="{{ survey.ui_strategy }}"
                        data-val-story="{{ survey.ui_context }}"
                        data-val-dim="{{ survey.sort_dim }}"
                        data-val-vol="{{ survey.ui_volume }}"
                        data-search-term="{{ survey.id }} {{ survey.ui_strategy | lower }} {{ survey.ui_context | lower }}">
                        
                        <td class="col-id center-align">
                            <div class="id-wrapper">
                                <span class="id-text">#{{ survey.id }}</span>
                                <button class="btn-copy-id" 
                                        type="button"
                                        title="{{ translations.copy_link }}"
                                        data-copy-text="{{ survey.ui_share_link }}"
                                        data-msg-copied="{{ translations.copied_to_clipboard }}">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        
                        <td class="col-date tabular-nums">
                            <span class="date-text">{{ survey.ui_date }}</span>
                        </td>
                        
                        <td class="col-status">
                            <span class="status-dot {{ survey.ui_status }}" 
                                  title="{{ survey.ui_status_tooltip }}"></span>
                        </td>
                        
                        <td class="col-strategy" title="{{ survey.ui_strategy }}">
                            <div class="strategy-name">{{ survey.ui_strategy }}</div>
                        </td>

                        <td class="col-story" title="{{ survey.ui_context }}">
                            <div class="context-text">{{ survey.ui_context }}</div>
                        </td>
                        
                        <td class="col-dim center-align">
                            <span class="dim-badge" data-dim="{{ survey.ui_dimension }}">{{ survey.ui_dimension }}</span>
                        </td>
                        
                        <td class="col-volume center-align tabular-nums">
                            <span class="volume-count {{ 'sufficient' if survey.ui_volume >= 30 else '' }}" data-volume="{{ survey.ui_volume }}">{{ survey.ui_volume }}</span>
                        </td>
                        
                        <td class="col-actions">
                            <div class="actions-wrapper">
                                <a href="{{ url_for('responses.get_survey_responses', survey_id=survey.id) }}" 
                                   class="btn-action btn-view" 
                                   target="_blank"
                                   title="{{ translations.view_responses }}">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </a>
                                
                                <a href="{{ url_for('survey.index', userID='...', surveyID='...', internalID=survey.id, lang=get_current_language(), demo='true') }}" 
                                   class="btn-action btn-take" 
                                   target="_blank"
                                   title="{{ translations.take_survey }}">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                        <polyline points="15 3 21 3 21 9"></polyline>
                                        <line x1="10" y1="14" x2="21" y2="3"></line>
                                    </svg>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
