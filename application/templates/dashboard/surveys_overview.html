{% extends "base.html" %}

{% block additional_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard_style.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <div class="dashboard-container">
        <!-- Header Section -->
        <header class="dashboard-header">
            <div class="header-content">
                <h1>{{ translations.title }}</h1>
                <p class="header-description">{{ translations.subtitle }}</p>
            </div>
        </header>

        <!-- Health Strip -->
        <div class="health-strip" role="region" aria-label="Dashboard health metrics">
            <div class="health-card">
                <div class="health-label">{{ translations.total_surveys }}</div>
                <div class="health-value">{{ total_surveys }}</div>
            </div>
            <div class="health-card">
                <div class="health-label">{{ translations.total_participants }}</div>
                <div class="health-value">{{ total_participants }}</div>
            </div>
            <div class="health-card">
                <div class="health-label">{{ translations.blocked_users }}</div>
                <div class="health-value">{{ unaware_users_count }}</div>
            </div>
        </div>

        <!-- Command Bar -->
        <div class="command-bar">
            <div class="search-wrapper">
                <div class="search-icon" aria-hidden="true">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </div>
                <input type="text" 
                       class="search-input" 
                       placeholder="{{ translations.search_placeholder }}"
                       data-search-term>
            </div>
            
            <div class="toggle-group">
                <button class="btn-toggle active" data-filter="active">
                    {{ translations.active_data_toggle }}
                </button>
                <button class="btn-toggle" data-filter="all">
                    {{ translations.all_surveys_toggle }}
                </button>
            </div>
        </div>

        <!-- The Master Table (Mission 2.3) -->
        <div class="table-responsive">
            <table class="master-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Identity</th>
                        <th>Dim</th>
                        <th>Volume</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for survey in surveys_console %}
                    <tr class="survey-row" 
                        data-survey-id="{{ survey.id }}"
                        data-is-active="{{ 'true' if survey.is_active_data else 'false' }}"
                        data-search-term="{{ survey.id }} {{ survey.ui_strategy | lower }} {{ survey.ui_context | lower }}">
                        
                        <td class="col-id">
                            <div class="id-wrapper">
                                <span class="id-text">#{{ survey.id }}</span>
                                <button class="btn-copy-id" 
                                        type="button"
                                        title="{{ translations.copied_to_clipboard }}"
                                        data-survey-id="{{ survey.id }}"
                                        data-msg-copied="{{ translations.copied_to_clipboard }}">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        
                        <td class="col-date">
                            <span class="date-text">{{ survey.ui_date }}</span>
                        </td>
                        
                        <td class="col-status">
                            <span class="status-dot {{ survey.ui_status }}" 
                                  title="{{ survey.ui_status | title }}"></span>
                        </td>
                        
                        <td class="col-identity">
                            <div class="identity-content">
                                <div class="strategy-name">{{ survey.ui_strategy }}</div>
                                <div class="context-text">{{ survey.ui_context }}</div>
                            </div>
                        </td>
                        
                        <td class="col-dim">
                            <span class="dim-badge" data-dim="{{ survey.ui_dimension }}">{{ survey.ui_dimension }}</span>
                        </td>
                        
                        <td class="col-volume">
                            <span class="volume-count" data-volume="{{ survey.ui_volume }}">{{ survey.ui_volume }}</span>
                        </td>
                        
                        <td class="col-actions">
                            <div class="actions-wrapper">
                                <a href="{{ url_for('responses.get_survey_responses', survey_id=survey.id) }}" 
                                   class="btn-action btn-view" 
                                   title="{{ translations.view_responses }}">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </a>
                                
                                <a href="{{ url_for('survey.index', userID='...', surveyID='...', internalID=survey.id, lang=get_current_language(), demo='true') }}" 
                                   class="btn-action btn-take" 
                                   target="_blank"
                                   title="{{ translations.take_survey }}">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                        <polyline points="15 3 21 3 21 9"></polyline>
                                        <line x1="10" y1="14" x2="21" y2="3"></line>
                                    </svg>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
